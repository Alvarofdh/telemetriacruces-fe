# Cursor Rules - Sistema de Monitoreo de Cruces Ferroviarios

## ğŸ“‹ **DescripciÃ³n General del Proyecto**
Este proyecto es la **tesis de IngenierÃ­a en InformÃ¡tica** sobre un **Sistema de Monitoreo de Cruces Ferroviarios Inteligentes**.

### ğŸ¯ **Objetivo Principal**
Automatizar la lectura de sensores (ESP32) y controlar estados del PLC (DVP28SV) para asegurar el funcionamiento seguro de los cruces ferroviarios, proporcionando monitoreo en tiempo real y alertas tempranas.

## ğŸ—ï¸ **Arquitectura del Sistema**

### **Hardware & IoT**
- **ESP32-WROOM-32U**: Captura datos de baterÃ­a, estado de sensores y detecciÃ³n de pasos de tren
- **PLC DVP28SV**: Controla barreras automÃ¡ticas y seÃ±alizaciÃ³n luminosa
- **IntegraciÃ³n**: ESP32 â†” PLC vÃ­a protocolo Modbus RTU
- **Sensores**: Proximidad, Velocidad, Peso, Estado de Barrera

### **Backend & Base de Datos**
- **Backend**: Django REST API
- **Base de Datos**: PostgreSQL (`cruces_ferroviarios`)
- **Tablas principales**: `cruce`, `sensor`, `registro_mantenimiento`, `historico_trafico`
- **Endpoints API**: `/api/cruces`, `/api/sensores`, `/api/alertas`, `/api/mantenimiento`

### **Frontend (React + Vite + Tailwind)**
- **Framework**: React 18 con Vite como bundler
- **Estilos**: Tailwind CSS v4
- **NavegaciÃ³n**: React Router DOM
- **Estado**: React Hooks (useState, useEffect)

## ğŸ“ **Estructura del Frontend**

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AlertPanel.jsx          # Panel de alertas en tiempo real
â”‚   â”œâ”€â”€ CrossingCard.jsx        # Tarjeta individual de cruce (navegable)
â”‚   â”œâ”€â”€ CrossingList.jsx        # Lista con filtros y bÃºsqueda
â”‚   â””â”€â”€ CruceDetail.jsx         # PÃ¡gina de detalle completa
â”œâ”€â”€ pages/                      # (Alternativa para pÃ¡ginas)
â”œâ”€â”€ assets/                     # Recursos estÃ¡ticos
â”œâ”€â”€ App.jsx                     # Router principal y Dashboard
â”œâ”€â”€ main.jsx                    # Punto de entrada React
â””â”€â”€ index.css                   # Estilos globales + Tailwind
```

## ğŸ¨ **Componentes Principales**

### **App.jsx**
- **Router principal** con BrowserRouter
- **Dashboard**: PÃ¡gina principal con estadÃ­sticas generales
- **Rutas**: `/` (dashboard) y `/cruce/:id` (detalle)
- **Filtros**: BÃºsqueda y filtros por estado (ACTIVO, MANTENIMIENTO, INACTIVO)

### **CrossingCard.jsx**
- **NavegaciÃ³n**: Clic en tarjeta o botÃ³n "Ver detalle" â†’ `/cruce/:id`
- **InformaciÃ³n mostrada**: Estado, baterÃ­a, sensores, ubicaciÃ³n
- **Interactividad**: Vista previa expandible, indicadores visuales de estado
- **Props**: `id_cruce`, `nombre`, `estado`, `bateria`, `sensores`, etc.

### **CruceDetail.jsx**
- **5 Tabs de informaciÃ³n**:
  1. **ğŸ“Š General**: Fechas, configuraciÃ³n tÃ©cnica
  2. **ğŸ”§ Sensores**: Estado individual de cada sensor
  3. **ğŸš† TrÃ¡fico**: Historial de trenes y velocidades
  4. **ğŸ“ UbicaciÃ³n**: Coordenadas GPS y direcciÃ³n
  5. **ğŸ‘¤ Contacto**: Responsable y datos de contacto
- **Datos**: InformaciÃ³n detallada con coordenadas reales de la regiÃ³n de Coquimbo

### **AlertPanel.jsx**
- **Alertas en tiempo real**: BaterÃ­a crÃ­tica, sensores desconectados
- **Tipos**: CRITICO, ADVERTENCIA, INFO
- **Estado**: LeÃ­do/No leÃ­do con marcado visual

### **CrossingList.jsx**
- **8 cruces de ejemplo** con datos realistas
- **Filtrado**: Por texto (nombre/ubicaciÃ³n) y estado
- **Ordenamiento**: Cruces activos primero
- **Estado vacÃ­o**: Mensaje cuando no hay resultados

## ğŸ”§ **ConfiguraciÃ³n TÃ©cnica**

### **Dependencias Principales**
```json
{
  "react": "^18.x",
  "react-dom": "^18.x",
  "react-router-dom": "^6.x",
  "tailwindcss": "^4.x",
  "vite": "^5.x"
}
```

### **Archivos de ConfiguraciÃ³n**
- **vite.config.js**: ConfiguraciÃ³n de Vite con Tailwind
- **index.html**: HTML base con meta tags SEO
- **package.json**: Scripts y dependencias
- **.gitignore**: Archivos excluidos del control de versiones

## ğŸ“Š **Estructura de Datos**

### **Modelo de Cruce**
```javascript
{
  id_cruce: number,
  nombre: string,
  estado: 'ACTIVO' | 'MANTENIMIENTO' | 'INACTIVO',
  bateria: number, // Porcentaje 0-100
  sensoresActivos: number, // Cantidad activa de 4
  ubicacion: string, // DirecciÃ³n completa
  ultimaActividad: string, // ISO Date
  tipoTren: 'Carga' | 'Pasajeros' | 'Mixto',
  velocidadPromedio: number, // km/h
  coordenadas: {
    latitud: number,
    longitud: number
  },
  instalacion: string, // Fecha ISO
  ultimoMantenimiento: string,
  proximoMantenimiento: string,
  historicoTrafico: Array<{
    fecha: string,
    trenes: number,
    velocidadMax: number
  }>,
  sensores: Array<{
    id: number,
    tipo: string,
    estado: string,
    ubicacion: string
  }>,
  configuracion: {
    tiempoAlerta: number, // segundos
    velocidadMaxima: number, // km/h
    tiempoBarrera: number, // segundos
    modoOperacion: 'AutomÃ¡tico' | 'Manual'
  },
  contacto: {
    responsable: string,
    telefono: string,
    email: string
  }
}
```

## ğŸ¯ **Funcionalidades Implementadas**

### **Dashboard Principal**
- **EstadÃ­sticas generales**: Total cruces, activos, en mantenimiento, inactivos, alertas de baterÃ­a
- **BÃºsqueda inteligente**: Por nombre de cruce o ubicaciÃ³n
- **Filtros dinÃ¡micos**: Por estado con contadores actualizados
- **Tiempo real**: Indicador de conexiÃ³n y Ãºltima actualizaciÃ³n

### **Sistema de NavegaciÃ³n**
- **NavegaciÃ³n fluida**: React Router con rutas dinÃ¡micas
- **Breadcrumbs**: BotÃ³n "Volver" en pÃ¡ginas de detalle
- **Deep linking**: URLs directas a cruces especÃ­ficos (`/cruce/1`)
- **Responsive**: Adaptado a dispositivos mÃ³viles y desktop

### **Alertas y Notificaciones**
- **Panel lateral**: Alertas crÃ­ticas, advertencias e informaciÃ³n
- **PriorizaciÃ³n**: Alertas crÃ­ticas primero
- **Estados visuales**: Colores diferenciados por tipo y estado de lectura
- **Timestamps**: Marcas de tiempo de cada alerta

## ğŸŒ **Datos GeogrÃ¡ficos**
- **RegiÃ³n**: Coquimbo, Chile
- **Coordenadas reales**: Latitudes y longitudes precisas
- **Ubicaciones**: Km especÃ­ficos en rutas 5 Norte, 43, 41, 31
- **Cruces incluidos**: La Serena, Coquimbo, Ovalle, VicuÃ±a, Illapel, Los Vilos, Salamanca, CombarbalÃ¡

## ğŸ”„ **Flujo de Datos**
```
ESP32 â†’ Django API â†’ PostgreSQL â†’ React Frontend
  â†“         â†“           â†“             â†“
Sensores â†’ Endpoints â†’ Base Datos â†’ Componentes UI
```

## ğŸ¨ **Patrones de DiseÃ±o UI**

### **Colores por Estado**
- **Verde**: Activo, baterÃ­a >70%, sensores operativos
- **Amarillo**: Mantenimiento, baterÃ­a 30-70%, advertencias
- **Rojo**: Inactivo, baterÃ­a <30%, errores crÃ­ticos
- **Azul**: Elementos de navegaciÃ³n e interacciÃ³n

### **Componentes Reutilizables**
- **Tarjetas**: Sombras, bordes redondeados, hover effects
- **Botones**: Estados hover, loading, disabled
- **Iconos**: SVG inline para mejor rendimiento
- **Indicadores**: Barras de progreso, badges de estado

## ğŸ“ **Convenciones de CÃ³digo**

### **Nomenclatura**
- **Componentes**: PascalCase (`CrossingCard.jsx`)
- **Funciones**: camelCase (`getEstadoStyles`)
- **Variables**: camelCase (`crucesDetallados`)
- **CSS Classes**: kebab-case (siguiendo Tailwind)

### **Estructura de Archivos**
- **Componentes** en `src/components/`
- **PÃ¡ginas** opcionales en `src/pages/`
- **Hooks personalizados**: `useFetchCruces()` (futuro)
- **Utils**: Funciones de formateo y validaciÃ³n
- **Assets**: ImÃ¡genes y recursos estÃ¡ticos

### **Props y State**
- **Props explÃ­citas**: Destructuring en parÃ¡metros
- **Estado local**: useState para componentes simples
- **Efectos**: useEffect para ciclo de vida
- **NavegaciÃ³n**: useNavigate y useParams de React Router

## ğŸ”® **PrÃ³ximas Implementaciones**
- **ConexiÃ³n real con API Django**
- **WebSockets para actualizaciones en tiempo real**
- **Mapas interactivos** con coordenadas GPS
- **GrÃ¡ficos de rendimiento** y estadÃ­sticas histÃ³ricas
- **Sistema de autenticaciÃ³n** y roles de usuario
- **ExportaciÃ³n de reportes** en PDF/Excel
- **ConfiguraciÃ³n de alertas personalizadas**

## ğŸ’¡ **Notas para Desarrollo**
- **Responsivo first**: DiseÃ±o mobile-first con Tailwind
- **Accesibilidad**: ARIA labels y navegaciÃ³n por teclado
- **Performance**: Lazy loading y code splitting
- **SEO**: Meta tags y structured data
- **Testing**: Preparado para Jest y React Testing Library
- **Deployment**: Configurado para Vercel/Netlify

## ğŸš€ **Comandos Ãštiles**
```bash
# Desarrollo
npm run dev          # Servidor de desarrollo
npm run build        # Build para producciÃ³n
npm run preview      # Preview del build

# InstalaciÃ³n de dependencias
npm install react-router-dom  # NavegaciÃ³n
npm install @types/react       # TypeScript support (futuro)
```

## ğŸ“± **URLs y Rutas**
- **Dashboard**: `/` - PÃ¡gina principal con lista de cruces
- **Detalle de cruce**: `/cruce/:id` - PÃ¡gina de informaciÃ³n completa
- **Ejemplo**: `/cruce/1` - Detalle del Cruce La Serena

## ğŸ”§ **Variables de Estado Importantes**
- **Estados de cruces**: `ACTIVO`, `MANTENIMIENTO`, `INACTIVO`
- **Tipos de tren**: `Carga`, `Pasajeros`, `Mixto`
- **Tipos de sensor**: `Proximidad`, `Velocidad`, `Peso`, `Barrera`
- **Tipos de alerta**: `CRITICO`, `ADVERTENCIA`, `INFO`
- **Modos de operaciÃ³n**: `AutomÃ¡tico`, `Manual` 